name: Release Backend

on:
  workflow_dispatch:
    inputs:
      version_bump:
        description: 'Version bump type'
        required: true
        default: 'patch'
        type: choice
        options:
          - patch
          - minor
          - major
      docker_registry:
        description: 'Docker registry (e.g., ghcr.io/username)'
        required: true
        default: 'ghcr.io'
      docker_image_name:
        description: 'Docker image name'
        required: true
        default: 'zentik-backend'

jobs:
  release:
    runs-on: ubuntu-latest
    
    # steps:
    # - uses: actions/checkout@v4
    #   with:
    #     fetch-depth: 0
    #     token: ${{ secrets.GITHUB_TOKEN }}
    
    # - name: Setup Node.js
    #   uses: actions/setup-node@v4
    #   with:
    #     node-version: '22'
    #     cache: 'npm'
    #     cache-dependency-path: package-lock.json
    
    # - name: Install dependencies
    #   run: npm ci
    
    # - name: Bump version
    #   run: |
    #     npm version ${{ github.event.inputs.version_bump }} --no-git-tag-version
    #     echo "NEW_VERSION=$(node -p "require('./package.json').version")" >> $GITHUB_ENV
    
    # - name: Build application
    #   run: npm run build
    
    # - name: Set up Docker Buildx
    #   uses: docker/setup-buildx-action@v3
    
    # - name: Log in to Container Registry
    #   uses: docker/login-action@v3
    #   with:
    #     registry: ${{ github.event.inputs.docker_registry }}
    #     username: ${{ github.actor }}
    #     password: ${{ secrets.GITHUB_TOKEN }}
    
    # - name: Extract metadata
    #   id: meta
    #   uses: docker/metadata-action@v5
    #   with:
    #     images: ${{ github.event.inputs.docker_registry }}/${{ github.actor }}/${{ github.event.inputs.docker_image_name }}
    #     tags: |
    #       type=ref,event=branch
    #       type=ref,event=pr
    #       type=sha,prefix={{branch}}-
    #       type=raw,value=latest,enable={{is_default_branch}}
    #       type=raw,value=${{ env.NEW_VERSION }}
    
    # - name: Build and push Docker image
    #   uses: docker/build-push-action@v5
    #   with:
    #     context: .
    #     push: true
    #     tags: ${{ steps.meta.outputs.tags }}
    #     labels: ${{ steps.meta.outputs.labels }}
    #     cache-from: type=gha
    #     cache-to: type=gha,mode=max
    
    # - name: Create Release
    #   uses: actions/create-release@v1
    #   env:
    #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    #   with:
    #     tag_name: v${{ env.NEW_VERSION }}
    #     release_name: Release v${{ env.NEW_VERSION }}
    #     draft: false
    #     prerelease: false
    
    # - name: Commit version bump
    #   run: |
    #     git config --local user.email "action@github.com"
    #     git config --local user.name "GitHub Action"
    #     git add package.json
    #     git commit -m "chore: bump version to ${{ env.NEW_VERSION }}"
    #     git push
